/*!
 * @package   yii2-detail-view
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version   1.7.1
 *
 * Client extension for the yii2-detail-view extension
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,n){var i=this;i.$element=e(t),e.each(n,function(e,t){i[e]=t}),i.init()};t.prototype={constructor:t,init:function(){var e=this;e.initElements(),e.listen()},alert:function(e,t){var n,i=this;return n=i.alertMessageSettings[e],t?(n=n||"alert alert-"+e,i.alertTemplate.replace("{content}",t).replace("{class}",n)):""},initAlert:function(){var t=this,n=t.$element.find(".kv-alert-container");n.find(".alert .close").each(function(){var t=e(this);t.off("click").on("click",function(){setTimeout(function(){n.find(".alert").length||n.hide()},300)})})},listen:function(){var t=this,n=t.$element.find(".kv-alert-container"),i=t.$element.find(".kv-detail-view");i.closest("form").on("afterValidate",function(e,t){void 0!==t&&i.removeClass("kv-detail-loading")}),t.$btnSave.on("click",function(){n.hide(),i.removeClass("kv-detail-loading").addClass("kv-detail-loading")}),t.$btnUpdate.on("click",function(){t.setMode("edit")}),t.$btnView.on("click",function(){t.setMode("view")}),t.$btnDelete.on("click",function(a){var l=e(this),d=t.deleteParams,s=t.deleteConfirm,o=t.deleteAjaxSettings||{};a.preventDefault(),(!s||confirm(s))&&(o=e.extend({type:"post",dataType:"json",data:d,url:l.attr("href"),beforeSend:function(){n.html("").hide(),i.removeClass("kv-detail-loading").addClass("kv-detail-loading")},success:function(a){a.success&&(i.hide(),t.$btnDelete.attr("disabled","disabled"),t.$btnUpdate.attr("disabled","disabled"),t.$btnView.attr("disabled","disabled"),t.$btnSave.attr("disabled","disabled")),e.each(a.messages,function(e,i){n.append(t.alert(e,i))}),n.hide().fadeIn("slow",function(){i.removeClass("kv-detail-loading"),t.initAlert()})},error:function(a,l,d){var s="";t.showErrorStack&&(s=e.trim(e(a.responseText).text()).replace(/\n\s*\n/g,"\n").replace(/\</g,"&lt;"),s=s.length?"<pre>"+s+"</pre>":""),s=t.alert("kv-detail-error",d+s),i.removeClass("kv-detail-loading"),n.html(s).hide().fadeIn("slow"),t.initAlert()}},o),e.ajax(o))}),t.initAlert()},setMode:function(e){var t=this,n=t.fadeDelay;"edit"===e?(t.$attribs.fadeOut(n,function(){t.$formAttribs.fadeIn(n),t.$element.removeClass("kv-view-mode kv-edit-mode").addClass("kv-edit-mode")}),t.$buttons1.fadeOut(n,function(){t.$buttons2.fadeIn(n)})):(t.$formAttribs.fadeOut(n,function(){t.$attribs.fadeIn(n),t.$element.removeClass("kv-view-mode kv-edit-mode").addClass("kv-view-mode")}),t.$buttons2.fadeOut(n,function(){t.$buttons1.fadeIn(n)}))},initElements:function(){var e=this,t=e.$element;e.$btnUpdate=t.find(".kv-btn-update"),e.$btnDelete=t.find(".kv-btn-delete"),e.$btnView=t.find(".kv-btn-view"),e.$btnSave=t.find(".kv-btn-save"),e.$attribs=t.find(".kv-attribute"),e.$formAttribs=t.find(".kv-form-attribute"),e.$buttons1=t.find(".kv-buttons-1"),e.$buttons2=t.find(".kv-buttons-2")}},e.fn.kvDetailView=function(n){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var a=e(this),l=a.data("kvDetailView"),d="object"==typeof n&&n;l||(l=new t(this,e.extend({},e.fn.kvDetailView.defaults,d,e(this).data())),a.data("kvDetailView",l)),"string"==typeof n&&l[n].apply(l,i)})},e.fn.kvDetailView.defaults={mode:"view",fadeDelay:800,alertTemplate:"",alertMessageSettings:{},deleteParams:{},deleteAjaxSettings:{},deleteConfirm:"",showErrorStack:!1},e.fn.kvDetailView.Constructor=t}(window.jQuery);